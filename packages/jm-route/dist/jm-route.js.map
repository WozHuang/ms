{"version":3,"file":"jm-route.js","sources":["../lib/index.js"],"sourcesContent":["function isPromise (obj) {\n  return !!obj && (typeof obj === 'object' || typeof obj === 'function') && typeof obj.then === 'function'\n}\n\n/**\n * Class representing a route.\n */\nclass Route {\n  constructor (fns) {\n    this.logging = false\n    this.benchmark = false\n    this.fns = [...arguments]\n  }\n\n  get fns () {\n    return this._fns\n  }\n\n  set fns (value) {\n    let fns = []\n    for (let i = 0, len = value.length; i < len; i++) {\n      let o = value[i]\n      if (Array.isArray(o)) {\n        fns.push(...o)\n      } else {\n        fns.push(o)\n      }\n    }\n    this._fns = fns\n  }\n\n  async execute (opts) {\n    let t1 = 0\n    let t2 = 0\n    let doc\n    let fns = this.fns\n    if (this.logging) {\n      if (this.benchmark) t1 = Date.now()\n      let msg = `Execute`\n      this.name && (msg += ` ${this.name}`)\n      msg += ` args: ${JSON.stringify([...arguments])}`\n      console.info(msg)\n    }\n    for (let i = 0, len = fns.length; i < len; i++) {\n      let fn = fns[i]\n      if (this.logging && this.benchmark) t2 = Date.now()\n      doc = fn(...arguments)\n      if (isPromise(doc)) {\n        doc = await doc\n      }\n      if (this.logging) {\n        let msg = `Step: ${i} ${fn.name} args: ${JSON.stringify([...arguments])}`\n        if (this.benchmark) msg += ` Elapsed time: ${Date.now() - t2}ms`\n        console.info(msg)\n      }\n      if (doc !== undefined) break\n    }\n    if (this.logging) {\n      let msg = `Executed`\n      this.name && (msg += ` ${this.name}`)\n      if (doc !== undefined) msg += ` result: ${JSON.stringify(doc)}`\n      if (this.benchmark) msg += ` Elapsed time: ${Date.now() - t1}ms`\n      console.info(msg)\n    }\n    if (doc !== undefined) return doc\n  }\n}\n\nmodule.exports = Route\n"],"names":["isNaN","apply","f","Promise","resolve","arguments","e","reject","args","i","length","value","then","test","update","body","stage","shouldContinue","__value","result","__state","updateValue","pact","bind","_resumeAfterTest","_resumeAfterBody","_resumeAfterUpdate","thenable","prototype","onFulfilled","onRejected","state","callback","__observer","_this","observer","direct","isPromise","obj","Route","fns","logging","benchmark","opts","t1","t2","doc","Date","now","msg","name","JSON","stringify","console","info","len","fn","undefined","_fns","o","Array","isArray","push","module","exports"],"mappings":"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"}