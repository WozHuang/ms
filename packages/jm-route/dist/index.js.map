{"version":3,"file":"index.js","sources":["../lib/index.js"],"sourcesContent":["function isPromise (obj) {\n  return !!obj && (typeof obj === 'object' || typeof obj === 'function') && typeof obj.then === 'function'\n}\n\n/**\n * Class representing a route.\n */\nclass Route {\n  constructor (fns) {\n    this.logging = false\n    this.benchmark = false\n    this.fns = [...arguments]\n  }\n\n  get fns () {\n    return this._fns\n  }\n\n  set fns (value) {\n    let fns = []\n    for (let i = 0, len = value.length; i < len; i++) {\n      let o = value[i]\n      if (Array.isArray(o)) {\n        fns.push(...o)\n      } else {\n        fns.push(o)\n      }\n    }\n    this._fns = fns\n  }\n\n  async execute (opts) {\n    let t1 = 0\n    let t2 = 0\n    let doc\n    let fns = this.fns\n    if (this.logging) {\n      if (this.benchmark) t1 = Date.now()\n      let msg = `Execute`\n      this.name && (msg += ` ${this.name}`)\n      msg += ` args: ${JSON.stringify([...arguments])}`\n      console.info(msg)\n    }\n    for (let i = 0, len = fns.length; i < len; i++) {\n      let fn = fns[i]\n      if (this.logging && this.benchmark) t2 = Date.now()\n      doc = fn(...arguments)\n      if (isPromise(doc)) {\n        doc = await doc\n      }\n      if (this.logging) {\n        let msg = `Step: ${i} ${fn.name} args: ${JSON.stringify([...arguments])}`\n        if (this.benchmark) msg += ` Elapsed time: ${Date.now() - t2}ms`\n        console.info(msg)\n      }\n      if (doc !== undefined) break\n    }\n    if (this.logging) {\n      let msg = `Executed`\n      this.name && (msg += ` ${this.name}`)\n      if (doc !== undefined) msg += ` result: ${JSON.stringify(doc)}`\n      if (this.benchmark) msg += ` Elapsed time: ${Date.now() - t1}ms`\n      console.info(msg)\n    }\n    if (doc !== undefined) return doc\n  }\n}\n\nmodule.exports = Route\n"],"names":["isNaN","apply","f","Promise","resolve","arguments","e","reject","args","i","length","value","then","test","update","body","stage","shouldContinue","__value","result","__state","updateValue","pact","bind","_resumeAfterTest","_resumeAfterBody","_resumeAfterUpdate","thenable","prototype","onFulfilled","onRejected","state","callback","__observer","_this","observer","direct","isPromise","obj","Route","fns","logging","benchmark","opts","t1","t2","doc","Date","now","msg","name","JSON","stringify","console","info","len","fn","undefined","_fns","o","Array","isArray","push","module","exports"],"mappings":"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"}