{"version":3,"file":"index.js","sources":["../lib/index.js"],"sourcesContent":["function isPromise (obj) {\n  return !!obj && (typeof obj === 'object' || typeof obj === 'function') && typeof obj.then === 'function'\n}\n\n/**\n * Class representing a route.\n */\nclass Route {\n  constructor () {\n    this.logging = false\n    this.benchmark = false\n    this.fns = [...arguments]\n  }\n\n  get fns () {\n    return this._fns\n  }\n\n  set fns (value) {\n    const fns = []\n    for (let i = 0, len = value.length; i < len; i++) {\n      const o = value[i]\n      if (Array.isArray(o)) {\n        fns.push(...o)\n      } else {\n        fns.push(o)\n      }\n    }\n    this._fns = fns\n  }\n\n  async execute () {\n    let t1 = 0\n    let t2 = 0\n    let doc\n    const fns = this.fns\n    if (this.logging) {\n      if (this.benchmark) t1 = Date.now()\n      let msg = 'Execute'\n      this.name && (msg += ` ${this.name}`)\n      msg += ` args: ${JSON.stringify([...arguments])}`\n      console.info(msg)\n    }\n    for (let i = 0, len = fns.length; i < len; i++) {\n      const fn = fns[i]\n      if (this.logging && this.benchmark) t2 = Date.now()\n      doc = fn(...arguments)\n      if (isPromise(doc)) {\n        doc = await doc\n      }\n      if (this.logging) {\n        let msg = `Step: ${i} ${fn.name} args: ${JSON.stringify([...arguments])}`\n        if (this.benchmark) msg += ` Elapsed time: ${Date.now() - t2}ms`\n        console.info(msg)\n      }\n      if (doc !== undefined) break\n    }\n    if (this.logging) {\n      let msg = 'Executed'\n      this.name && (msg += ` ${this.name}`)\n      if (doc !== undefined) msg += ` result: ${JSON.stringify(doc)}`\n      if (this.benchmark) msg += ` Elapsed time: ${Date.now() - t1}ms`\n      console.info(msg)\n    }\n    if (doc !== undefined) return doc\n  }\n}\n\nmodule.exports = Route\n"],"names":["value","__value","_this","result","pact","__state","then","observer","isPromise","obj","Route","logging","benchmark","fns","arguments","t1","t2","doc","Date","now","msg","name","JSON","stringify","console","info","i","len","length","fn","undefined","_fns","o","Array","isArray","push"],"mappings":"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"}