{"version":3,"file":"index.js","sources":["../lib/ws.js","../../../node_modules/jm-err/dist/index.esm.js","../../../node_modules/jm-net/dist/index.esm.js","../lib/mdl/fnclient.js","../lib/mdl/index.js","../lib/index.js"],"sourcesContent":["const { EventEmitter } = require('jm-event')\nconst WebSocket = require('ws')\n\nmodule.exports = class Adapter extends EventEmitter {\n  constructor (uri) {\n    super({ async: true })\n    const ws = new WebSocket(uri)\n    this.ws = ws\n    ws.on('message', (data, flags) => {\n      this.emit('message', data)\n    })\n    ws.onopen = () => {\n      this.emit('open')\n    }\n    ws.onerror = event => {\n      this.emit('error', event)\n    }\n    ws.onclose = event => {\n      this.emit('close', event)\n    }\n  }\n\n  send () {\n    this.ws.send(...arguments)\n  }\n\n  close () {\n    if (!this.ws) return\n    this.ws.close(...arguments)\n  }\n}\n","var zh_CN = {\n  'Success': '成功',\n  'Fail': '失败',\n  'System Error': '系统错误',\n  'Network Error': '网络错误',\n  'Parameter Error': '参数错误',\n  'Busy': '忙',\n  'Time Out': '超时',\n  'Abort': '中止',\n  'Not Ready': '未准备好',\n  'Not Exists': '不存在',\n  'Already Exists': '已存在',\n  'Validation Error': '校验错误',\n  'OK': 'OK',\n  'Bad Request': '错误请求',\n  'Unauthorized': '未验证',\n  'Forbidden': '无权限',\n  'Not Found': '未找到',\n  'Internal Server Error': '服务器内部错误',\n  'Service Unavailable': '无效服务'\n};\n\nvar lngs = {\n  zh_CN: zh_CN\n  /**\n   * translate\n   * @param {string} msg - msg to be translate\n   * @param {string} lng - language\n   * @return {String | null}\n   */\n\n};\n\nvar locale = function locale(msg, lng) {\n  if (!lng || !lngs[lng]) return null;\n  return lngs[lng][msg];\n};\n\n/**\n * err module.\n * @module err\n */\n\nfunction isNumber(obj) {\n  return typeof obj === 'number' && isFinite(obj);\n}\n/**\n * common error defines\n *\n */\n\n\nvar Err = {\n  SUCCESS: {\n    err: 0,\n    msg: 'Success'\n  },\n  FAIL: {\n    err: 1,\n    msg: 'Fail'\n  },\n  FA_SYS: {\n    err: 2,\n    msg: 'System Error'\n  },\n  FA_NETWORK: {\n    err: 3,\n    msg: 'Network Error'\n  },\n  FA_PARAMS: {\n    err: 4,\n    msg: 'Parameter Error'\n  },\n  FA_BUSY: {\n    err: 5,\n    msg: 'Busy'\n  },\n  FA_TIMEOUT: {\n    err: 6,\n    msg: 'Time Out'\n  },\n  FA_ABORT: {\n    err: 7,\n    msg: 'Abort'\n  },\n  FA_NOTREADY: {\n    err: 8,\n    msg: 'Not Ready'\n  },\n  FA_NOTEXISTS: {\n    err: 9,\n    msg: 'Not Exists'\n  },\n  FA_EXISTS: {\n    err: 10,\n    msg: 'Already Exists'\n  },\n  FA_VALIDATION: {\n    err: 11,\n    msg: 'Validation Error'\n  },\n  OK: {\n    err: 200,\n    msg: 'OK'\n  },\n  FA_BADREQUEST: {\n    err: 400,\n    msg: 'Bad Request'\n  },\n  FA_NOAUTH: {\n    err: 401,\n    msg: 'Unauthorized'\n  },\n  FA_NOPERMISSION: {\n    err: 403,\n    msg: 'Forbidden'\n  },\n  FA_NOTFOUND: {\n    err: 404,\n    msg: 'Not Found'\n  },\n  FA_INTERNALERROR: {\n    err: 500,\n    msg: 'Internal Server Error'\n  },\n  FA_UNAVAILABLE: {\n    err: 503,\n    msg: 'Service Unavailable'\n  }\n};\nErr.t = locale;\n/**\n * return message from template\n *\n * ```javascript\n * errMsg('sampe ${name} ${value}', {name: 'jeff', value: 123});\n * // return 'sample jeff 123'\n * ```\n *\n * @param {String} msg message template\n * @param {Object} opts params\n * @return {String} final message\n */\n\nfunction errMsg(msg, opts) {\n  if (opts) {\n    for (var key in opts) {\n      msg = msg.split('${' + key + '}').join(opts[key]);\n    }\n  }\n\n  return msg;\n}\n/**\n * return an Error Object\n * @param {Object|String} E Err object or a message template\n * @param {Object} [opts] params\n * @return {Error}\n */\n\n\nfunction err(E, opts) {\n  if (typeof E === 'string') {\n    E = {\n      msg: E\n    };\n  }\n\n  var msg = errMsg(E.msg || E.message, opts);\n  var code = E.err;\n  code === undefined && (code = Err.FAIL.err);\n  var status = Err.FA_INTERNALERROR.err;\n  if (code === Err.SUCCESS.err) status = 200;\n  if (isNumber(code) && code >= 200 && code <= 600) status = code;\n  E.status !== undefined && (status = E.status);\n  var e = new Error(msg);\n  e.code = code;\n  e.status = status;\n  e.data = Object.assign(E, {\n    err: code,\n    msg: msg,\n    status: status\n  });\n  return e;\n}\n/**\n * enable Err Object, errMsg and err function for obj\n * @param {Object} obj target object\n * @param {String} [name] name to bind\n * @return {boolean}\n */\n\n\nfunction enableErr(obj) {\n  var name = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 'Err';\n  if (obj[name]) return false;\n  obj[name] = Err;\n  obj.err = err;\n  obj.errMsg = errMsg;\n  return true;\n}\n/**\n * disable Err Object, errMsg and err function for obj\n * @param {Object} obj target object\n * @param {String} [name] name to bind\n */\n\n\nfunction disableErr(obj) {\n  var name = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 'Err';\n  if (!obj[name]) return;\n  delete obj[name];\n  delete obj.err;\n  delete obj.errMsg;\n}\n\nvar $ = {\n  Err: Err,\n  errMsg: errMsg,\n  err: err,\n  enableErr: enableErr,\n  disableErr: disableErr\n};\nvar lib = $;\n\nexport default lib;\n//# sourceMappingURL=index.esm.js.map\n","import jmEvent from 'jm-event';\n\nfunction _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}\n\nfunction _defineProperties(target, props) {\n  for (var i = 0; i < props.length; i++) {\n    var descriptor = props[i];\n    descriptor.enumerable = descriptor.enumerable || false;\n    descriptor.configurable = true;\n    if (\"value\" in descriptor) descriptor.writable = true;\n    Object.defineProperty(target, descriptor.key, descriptor);\n  }\n}\n\nfunction _createClass(Constructor, protoProps, staticProps) {\n  if (protoProps) _defineProperties(Constructor.prototype, protoProps);\n  if (staticProps) _defineProperties(Constructor, staticProps);\n  return Constructor;\n}\n\nfunction _toConsumableArray(arr) {\n  return _arrayWithoutHoles(arr) || _iterableToArray(arr) || _nonIterableSpread();\n}\n\nfunction _arrayWithoutHoles(arr) {\n  if (Array.isArray(arr)) {\n    for (var i = 0, arr2 = new Array(arr.length); i < arr.length; i++) arr2[i] = arr[i];\n\n    return arr2;\n  }\n}\n\nfunction _iterableToArray(iter) {\n  if (Symbol.iterator in Object(iter) || Object.prototype.toString.call(iter) === \"[object Arguments]\") return Array.from(iter);\n}\n\nfunction _nonIterableSpread() {\n  throw new TypeError(\"Invalid attempt to spread non-iterable instance\");\n}\n\nvar PingTimeout = 60000; // 默认心跳时间 60 秒\n\nvar PongTimeout = 10000; // 默认响应超时时间 10 秒\n\nvar HeartBeat =\n/*#__PURE__*/\nfunction () {\n  function HeartBeat() {\n    var opts = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n\n    _classCallCheck(this, HeartBeat);\n\n    jmEvent.enableEvent(this);\n    var _opts$pingTimeout = opts.pingTimeout,\n        pingTimeout = _opts$pingTimeout === void 0 ? PingTimeout : _opts$pingTimeout,\n        _opts$pongTimeout = opts.pongTimeout,\n        pongTimeout = _opts$pongTimeout === void 0 ? PongTimeout : _opts$pongTimeout;\n    this.pingTimeout = pingTimeout;\n    this.pongTimeout = pongTimeout;\n  }\n\n  _createClass(HeartBeat, [{\n    key: \"reset\",\n    value: function reset() {\n      this.stop();\n      this.start();\n      return this;\n    }\n  }, {\n    key: \"start\",\n    value: function start() {\n      var _this = this;\n\n      var pingTimeout = this.pingTimeout,\n          pongTimeout = this.pongTimeout;\n      this.pingTimer = setTimeout(function () {\n        if (_this.emit('heartBeat')) {\n          _this.pongTimer = setTimeout(function () {\n            _this.emit('heartDead');\n          }, pongTimeout);\n        }\n      }, pingTimeout);\n      return this;\n    }\n  }, {\n    key: \"stop\",\n    value: function stop() {\n      this.pingTimer && clearTimeout(this.pingTimer);\n      this.pongTimer && clearTimeout(this.pongTimer);\n      return this;\n    }\n  }]);\n\n  return HeartBeat;\n}();\n\nHeartBeat.PingTimeout = PingTimeout;\nHeartBeat.PongTimeout = PongTimeout;\nvar heartbeat = HeartBeat;\n\nvar _async = function () {\n  try {\n    if (isNaN.apply(null, {})) {\n      return function (f) {\n        return function () {\n          try {\n            return Promise.resolve(f.apply(this, arguments));\n          } catch (e) {\n            return Promise.reject(e);\n          }\n        };\n      };\n    }\n  } catch (e) {}\n\n  return function (f) {\n    // Pre-ES5.1 JavaScript runtimes don't accept array-likes in Function.apply\n    return function () {\n      var args = [];\n\n      for (var i = 0; i < arguments.length; i++) {\n        args[i] = arguments[i];\n      }\n\n      try {\n        return Promise.resolve(f.apply(this, args));\n      } catch (e) {\n        return Promise.reject(e);\n      }\n    };\n  };\n}();\n\nfunction _await(value, then, direct) {\n  if (direct) {\n    return then ? then(value) : value;\n  }\n\n  value = Promise.resolve(value);\n  return then ? value.then(then) : value;\n}\nvar PingFailedCode = 4999; // 心跳失败后，关闭 code, 4000 至 4999 之间\n\nvar MaxReconnectAttempts = 0; // 默认重试次数0 表示无限制\n\nvar ReconnectTimeout = 3000; // 默认自动重连延时 3 秒\n\nvar WebSocket =\n/*#__PURE__*/\nfunction () {\n  function WebSocket() {\n    var _this = this;\n\n    var opts = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n\n    _classCallCheck(this, WebSocket);\n\n    jmEvent.enableEvent(this);\n    var Adapter = opts.Adapter,\n        _opts$timeout = opts.timeout,\n        _opts$reconnect = opts.reconnect,\n        reconnect = _opts$reconnect === void 0 ? true : _opts$reconnect,\n        _opts$reconnectTimeou = opts.reconnectTimeout,\n        reconnectTimeout = _opts$reconnectTimeou === void 0 ? ReconnectTimeout : _opts$reconnectTimeou,\n        _opts$reconnectAttemp = opts.reconnectAttempts,\n        reconnectAttempts = _opts$reconnectAttemp === void 0 ? MaxReconnectAttempts : _opts$reconnectAttemp,\n        _opts$pingFailedCode = opts.pingFailedCode,\n        pingFailedCode = _opts$pingFailedCode === void 0 ? PingFailedCode : _opts$pingFailedCode;\n    if (!Adapter) throw new Error('invalid Adapter');\n    this.Adapter = Adapter;\n    this.pingFailedCode = pingFailedCode;\n    this.reconnect = reconnect;\n    this.reconnectTimeout = reconnectTimeout;\n    this.maxReconnectAttempts = reconnectAttempts;\n    this.reconnectAttempts = 0;\n    this._reconnectTimer = null;\n    this.uri = null;\n    this.ws = null;\n    this.connecting = null; // or a promise instance\n\n    var heart = new heartbeat(opts);\n    this.heart = heart;\n    heart.on('heartBeat', function () {\n      return _this.emit('heartBeat');\n    }).on('heartDead', function () {\n      if (_this.emit('heartDead')) return;\n\n      _this.close(_this.pingFailedCode, 'heartbeat timeout');\n    });\n  }\n\n  _createClass(WebSocket, [{\n    key: \"onReady\",\n    value: function onReady() {\n      if (this.ws) return;\n      return this.connect();\n    }\n  }, {\n    key: \"connect\",\n    value: function connect(uri) {\n      uri && (this.uri = uri);\n\n      if (!this.connecting) {\n        this.connecting = this._connect();\n      }\n\n      return this.connecting;\n    }\n  }, {\n    key: \"send\",\n    value: _async(function () {\n      var _this2 = this,\n          _arguments = arguments;\n\n      return _await(_this2.onReady(), function () {\n        try {\n          var _this2$ws;\n\n          (_this2$ws = _this2.ws).send.apply(_this2$ws, _toConsumableArray(_arguments));\n\n          _this2.heart.reset();\n        } catch (e) {\n          throw e;\n        }\n      });\n    })\n  }, {\n    key: \"close\",\n    value: function close() {\n      var _this$ws;\n\n      this._stopReconnect();\n\n      if (!this.ws) return;\n\n      (_this$ws = this.ws).close.apply(_this$ws, arguments);\n\n      this.ws = null;\n      this.connecting = null;\n    }\n  }, {\n    key: \"_connect\",\n    value: _async(function () {\n      var _this3 = this;\n\n      var uri = _this3.uri;\n      if (!uri) throw new Error('invalid uri');\n      if (_this3.ws) return;\n\n      _this3.emit('connect');\n\n      return new Promise(function (resolve, reject) {\n        var ws = null;\n\n        try {\n          ws = new _this3.Adapter(uri);\n        } catch (e) {\n          return reject(e);\n        }\n\n        ws.on('message', function (opts) {\n          _this3.heart.reset();\n\n          _this3.emit('message', opts);\n        }).on('open', function (opts) {\n          _this3.emit('open', opts);\n\n          _this3.ws = ws;\n          _this3.connecting = null;\n\n          _this3.heart.reset();\n\n          _this3._stopReconnect();\n\n          resolve();\n        }).on('error', function (e) {\n          _this3.emit('error', e);\n\n          reject(e);\n        }).on('close', function (opts) {\n          _this3.emit('close', opts);\n\n          _this3.heart.stop();\n\n          _this3.ws = null;\n          _this3.connecting = null;\n          var _opts$wasClean = opts.wasClean,\n              wasClean = _opts$wasClean === void 0 ? true : _opts$wasClean,\n              code = opts.code;\n          if (wasClean && code !== _this3.pingFailedCode) return;\n\n          if (_this3.reconnect) {\n            _this3._reconnect();\n          }\n        });\n      });\n    })\n  }, {\n    key: \"_reconnect\",\n    value: function _reconnect() {\n      var _this4 = this;\n\n      if (this.maxReconnectAttempts && this.reconnectAttempts >= this.maxReconnectAttempts) {\n        this.emit('connectFail');\n\n        this._stopReconnect();\n\n        return;\n      }\n\n      this.reconnectAttempts++;\n      this.emit('reconnect');\n      this._reconnectTimer = setTimeout(function () {\n        _this4._reconnectTimer = null;\n\n        _this4.connect().catch(function () {});\n      }, this.reconnectTimeout);\n    }\n  }, {\n    key: \"_stopReconnect\",\n    value: function _stopReconnect() {\n      if (this._reconnectTimer) {\n        clearTimeout(this._reconnectTimer);\n        this._reconnectTimer = null;\n      }\n\n      this.reconnectAttempts = 0;\n    }\n  }, {\n    key: \"ready\",\n    get: function get() {\n      return this.ws ? true : false;\n    }\n  }]);\n\n  return WebSocket;\n}();\n\nWebSocket.MaxReconnectAttempts = MaxReconnectAttempts;\nWebSocket.ReconnectTimeout = ReconnectTimeout;\nWebSocket.PingFailedCode = PingFailedCode;\nvar ws = WebSocket;\n\nvar $ = {\n  HeartBeat: heartbeat,\n  WebSocket: ws\n};\nvar lib = $;\n\nexport default lib;\n//# sourceMappingURL=index.esm.js.map\n","const event = require('jm-event')\nconst log = require('jm-logger')\nconst { utils } = require('jm-ms-core')\nconst error = require('jm-err')\nconst { WebSocket: WS } = require('jm-net')\n\nconst Err = error.Err\n\nconst Timeout = 60000 // 请求超时时间 60 秒\nconst MAXID = 999999\nlet errNetwork = error.err(Err.FA_NETWORK)\n\nmodule.exports = function (_Adapter) {\n  return function (opts = {}) {\n    if (typeof opts === 'string') {\n      opts = { uri: opts }\n    }\n\n    const { uri, timeout = Timeout, logger = log.logger } = opts\n    let { prefix = '' } = opts\n\n    if (!uri) throw error.err(error.Err.FA_PARAMS)\n\n    let path = utils.getUriPath(uri)\n    prefix = path + prefix\n\n    let id = 0\n    let cbs = {}\n\n    const ws = new WS(Object.assign({ Adapter: _Adapter }, opts))\n    ws.connect(uri)\n\n    const doc = {\n      uri,\n      prefix,\n\n      onReady: function () {\n        return ws.onReady()\n      },\n\n      async request (opts) {\n        await this.onReady()\n        opts = utils.preRequest.apply(this, arguments)\n        opts.uri = this.prefix + (opts.uri || '')\n        if (id >= MAXID) id = 0\n        id++\n        opts.id = id\n        this.send(JSON.stringify(opts))\n        return new Promise((resolve, reject) => {\n          cbs[id] = {\n            resolve,\n            reject\n          }\n\n          const t = opts.timeout || timeout\n          setTimeout(() => {\n            if (cbs[id]) {\n              delete cbs[id]\n              const e = error.err(Err.FA_TIMEOUT)\n              reject(e)\n            }\n          }, t)\n        })\n      },\n\n      async notify (opts) {\n        await this.onReady()\n        opts = utils.preRequest.apply(this, arguments)\n        if (!this.connected) throw errNetwork\n        opts.uri = this.prefix + (opts.uri || '')\n        this.send(JSON.stringify(opts))\n      },\n\n      send: function () {\n        ws.send(...arguments)\n      },\n\n      close: function () {\n        ws.close()\n      }\n    }\n    event.enableEvent(doc)\n\n    const onmessage = function (message) {\n      doc.emit('message', message)\n      let json = null\n      try {\n        json = JSON.parse(message)\n      } catch (err) {\n        return\n      }\n      if (json.id) {\n        if (cbs[json.id]) {\n          let p = cbs[json.id]\n          let err = null\n          let doc = json.data\n          if (doc.err) {\n            err = error.err(doc)\n            p.reject(err)\n          } else {\n            p.resolve(doc)\n          }\n          delete cbs[json.id]\n        }\n      }\n    }\n\n    ws\n      .on('message', message => {\n        onmessage(message)\n      })\n      .on('open', () => {\n        id = 0\n        cbs = {}\n        doc.emit('open')\n        logger.info('ws.opened', uri)\n      })\n      .on('error', e => {\n        doc.emit('error', e)\n        logger.error('ws.error', uri)\n        logger.error(e)\n      })\n      .on('close', event => {\n        doc.emit('close', event)\n        logger.info('ws.closed', uri)\n      })\n      .on('heartBeat', () => {\n        if (doc.emit('heartBeat')) return true\n        doc.request('/', 'get').catch(e => {})\n        return true\n      })\n      .on('heartDead', () => {\n        logger.info('ws.heartDead', uri)\n        return doc.emit('heartDead')\n      })\n      .on('connect', () => {\n        doc.emit('connect')\n        logger.info('ws.connect', uri)\n      })\n      .on('reconnect', () => {\n        doc.emit('reconnect')\n        logger.info('ws.reconnect', uri)\n      })\n      .on('connectFail', () => {\n        doc.emit('connectFail')\n        logger.info('ws.connectFail', uri)\n      })\n\n    return doc\n  }\n}\n","const fnclient = require('./fnclient')\n\nmodule.exports = function (Adapter) {\n  let client = fnclient(Adapter)\n  let $ = function (name = 'ms-ws-client') {\n    let app = this\n    app.clientModules.ws = client\n    app.clientModules.wss = client\n\n    return {\n      name: name,\n      unuse: () => {\n        delete app.clientModules.ws\n        delete app.clientModules.wss\n      }\n    }\n  }\n\n  $.client = client\n  return $\n}\n","const Adapter = require('./ws')\nconst mdl = require('./mdl')\n\nmodule.exports = mdl(Adapter)\n"],"names":["EventEmitter","require$$0","uri","async","ws","WebSocket","on","data","flags","emit","onopen","onerror","event","onclose","send","arguments","close","PingTimeout","PongTimeout","HeartBeat","opts","pingTimeout","pongTimeout","setTimeout","clearTimeout","f","Promise","e","reject","value","utils","WS","require$$1","Err","error","Timeout","MAXID","errNetwork","err","FA_NETWORK","_Adapter","timeout","logger","log","prefix","FA_PARAMS","path","getUriPath","id","cbs","Object","assign","Adapter","connect","doc","onReady","request","preRequest","apply","JSON","stringify","resolve","t","FA_TIMEOUT","notify","connected","enableEvent","onmessage","message","json","parse","p","info","client","fnclient","$","name","app","clientModules","wss","unuse","mdl"],"mappings":"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"}