{"version":3,"file":"module.browser.js","sources":["../lib/mdl/fnclient.js","../lib/mdl/index.js"],"sourcesContent":["const event = require('jm-event')\nconst error = require('jm-err')\nconst utils = require('jm-ms-core').utils\n\nlet fnclient = function (_adapter) {\n  return async function (opts = {}) {\n    if (typeof opts === 'string') {\n      opts = {uri: opts}\n    }\n    if (!opts.uri) throw error.err(error.Err.FA_PARAMS)\n    let adapter = opts.adapter || _adapter\n    let uri = opts.uri\n    let timeout = opts.timeout || 0\n\n    let doc = {\n      async request (opts) {\n        opts = utils.preRequest.apply(this, arguments)\n        let headers = opts.headers || {}\n        let noHeaders = ['host', 'if-none-match', 'content-type', 'content-length', 'connection']\n        noHeaders.forEach(function (key) {\n          if (headers[key]) delete headers[key]\n        })\n        if (opts.ips) {\n          headers['x-forwarded-for'] = opts.ips.toString()\n        }\n        if (opts.lng) {\n          headers['lng'] = opts.lng\n        }\n\n        let _opts = {\n          method: opts.type || 'get',\n          timeout: opts.timeout || timeout,\n          headers: headers\n        }\n        let url = uri + opts.uri\n        try {\n          let doc = await adapter.request(url, opts.data, _opts)\n          let data = doc.data\n          if (data && data.err) {\n            let e = error.err(data)\n            throw e\n          }\n          return data\n        } catch (e) {\n          let data = null\n          e.response && e.response.data && (data = e.response.data)\n          if (data && data.err) {\n            let e = error.err(data)\n            throw e\n          }\n          data && (e.data = data)\n          throw e\n        }\n      },\n      async notify (opts) {\n        await this.request.apply(this, arguments)\n      },\n      onReady () {\n        return true\n      }\n    }\n    event.enableEvent(doc)\n    return doc\n  }\n}\n\nmodule.exports = fnclient\n","const fnclient = require('./fnclient')\n\nmodule.exports = function (adapter) {\n  let client = fnclient(adapter)\n  let $ = function (name = 'ms-http-client') {\n    let app = this\n    app.clientModules.http = client\n    app.clientModules.https = client\n\n    return {\n      name: name,\n      unuse: () => {\n        delete app.clientModules.http\n        delete app.clientModules.https\n      }\n    }\n  }\n\n  $.client = client\n  return $\n}\n"],"names":["utils","require$$0","fnclient","_adapter","opts","uri","error","err","Err","FA_PARAMS","adapter","timeout","doc","request","preRequest","apply","headers","noHeaders","forEach","key","ips","toString","lng","_opts","method","type","url","data","e","response","notify","onReady","event","enableEvent","client","$","name","app","clientModules","http","https","unuse"],"mappings":"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"}